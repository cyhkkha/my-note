# 数据库

by 菲尼莫斯 2019年4月20日

---

## 基础

键：
* 超键：能唯一标识一行数据的列组合
* 候选键：最小的超键组合，不再包含多余的列
* 主键：候选键中的一个，被用于该表的行标识，主键不能为null
* 外键：当前表中包含的其他表的主键

数据库事务的特性
* 原子性：一个事务中所有的数据库操作要么全部完成，要么全部不完成，若中间的一步发生错误则进行回滚。
* 一致性：事务发生前后，数据库的完整性约束没有破坏
* 隔离性：同一时间只能有一个事务对同一数据进行操作（串行）
* 持久性：事务一旦成功便会永久生效，不会回滚

索引：
* 类似于数据库的目录，用以协助快速查询，底层使用B树（平衡树）来实现
* 索引能够大大提高表的**检索**速度，能够提高**分组**和**排序**的速度
* 创建索引会导致空间使用率增加
* 在数据增删改的时候，索引会进行动态维护，从而降低了速度

## 进阶

聚集索引：即主键，聚集索引让整个数据库形成了一颗平衡树，该树保存了所有的主键

常规索引：（非聚集索引）建立一颗保存其他字段数据的平衡树，该树指向了这些字段所对应行的主键，所以是先用非聚集索引搜索主键，再用聚集索引来查找主键对应的值。

复合索引：即指定一个以上的字段作为索引，这样平衡树中会复制多个字段，这样我们在查找单一而不是整行数据的时候，就可以不再利用聚集索引来调出整行数据，从而降低了查询时间。

范式：
* 1NF：一列不能有多个值，如json数据的字段可以为数组，是不满足1NF的。
* 2NF：其他属性必须完全依赖于主属性，如下json中：主键为`{学号，科目}`，可见`{成绩}`是依赖于主键的，但`{平均分}`却只依赖于`{科目}`这一属性，不完全依赖于主键，因此不满足2NF。
```json
"成绩": {
    "学号": 1,
    "科目": "数学",
    "成绩": 59,
    "平均分": 99,
}
```
* 3NF：非主属性之间不得存在依赖，如下json中，`{班主任}`这一属性完全依赖于主键`{学号}`满足了2NF，但它也依赖于`{班级}`这个非主属性，因此不满足3NF。
```json
"学生": {
    "学号": 1,
    "姓名": "小明",
    "班级": "火箭班",
    "班主任": "王某"
}
```
